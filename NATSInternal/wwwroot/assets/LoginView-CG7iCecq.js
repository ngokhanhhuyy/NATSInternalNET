var M=Object.defineProperty;var P=(t,r,o)=>r in t?M(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o;var h=(t,r,o)=>(P(t,typeof r!="symbol"?r+"":r,o),o);import{g as C,h as N,C as A,U as B,I as U,O as L,N as V,B as D,d as F,i as J,j as k,a as y,c as b,b as e,w as u,v as S,n as w,u as c,k as f,t as x,l as I,e as T,m as O,p as K,q as z,s as $,x as G,_ as H}from"./index-t81Ut7qy.js";import{u as Q}from"./upsertViewStatesComposable-CCB0pErc.js";import"./viewStatesComposable-B_gfPsac.js";class W{constructor(){h(this,"authStore",C());h(this,"url",N.API_URI_DEV)}async getAccessTokenAsync(r){let o;try{o=await fetch(`${N.API_URI_DEV}/authentication/getAccessToken`,{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify(r)})}catch(n){throw n instanceof TypeError?new A:n}const g=await o.text();if(o.ok)return JSON.parse(g);{const n=JSON.parse(g);switch(o.status){case 400:throw new D(n);case 404:throw new V(n);case 422:throw new L(n);case 500:throw new U;default:throw new B}}}}function X(){return new W}class Y{constructor(){h(this,"userName","");h(this,"password","")}toRequestDto(){return{userName:this.userName,password:this.password}}}const _=t=>($("data-v-0b6ec359"),t=t(),G(),t),Z={class:"row py-3 g-3 justify-content-center"},ee={class:"col col-xxl-4 col-xl-4 col-lg-5 col-md-6 col-sm-8 col-12 d-flex align-items-center"},se={class:"block bg-white border border-primary-subtle rounded-3 shadow-sm w-100 p-3"},oe={class:"form-group mb-3"},te={class:"form-floating"},re=_(()=>e("label",{class:"form-label"},"Tên tài khoản",-1)),ne={class:"form-group mb-3"},ae={class:"form-floating"},ie=_(()=>e("label",{class:"form-label"},"Mật khẩu",-1)),ce={class:"form-group"},le=["disabled"],de={class:"spinner-border spinner-border-sm","aria-hidden":"true"},ue={key:0,class:"alert alert-danger d-flex justify-content-center mt-3 w-100"},me=_(()=>e("i",{class:"bi bi-exclamation-triangle-fill me-1"},null,-1)),pe={key:1,class:"alert alert-success d-flex justify-content-center w-100"},he=_(()=>e("i",{class:"bi bi-check-circle-fill me-1"},null,-1)),fe=F({__name:"LoginView",setup(t){const r=K(),o=z(),g=X(),n=C(),R=J(),d=k(new Y),{modelState:i,loadingState:m,clearLeavingConfirmation:j}=Q();j();const l=k({commonError:null,loggedIn:!1});function E(){let s=d.userName.length>0,a=d.password.length>0;return!(!s||!a)}async function v(){m.isLoading=!0,l.commonError=null,i.resetErrors();try{const s=await g.getAccessTokenAsync(d.toRequestDto());n.setAccessToken(s.accessToken),n.setRefreshToken(s.refreshToken),n.setUserName(d.userName),n.setExpiringDateTime(s.expiringDateTime),await R.loadCurrentUser(s.userId),m.isLoading=!1,l.loggedIn=!0,await new Promise(p=>{setTimeout(()=>p(void 0),1e3)});const a=r.query.returningPath;a?await o.push({path:a}):await o.push({name:"home"})}catch(s){if(s instanceof D||s instanceof V||s instanceof L)i.setErrors(s.errors);else if(s instanceof U)l.commonError="Đã xảy ra lỗi từ máy chủ";else if(s instanceof A)l.commonError="Không thể kết nối đến máy chủ";else throw l.commonError="Đã xảy ra lỗi không xác định",s;m.isLoading=!1}}function q(){E()&&v()}return(s,a)=>(y(),b("div",{class:"container-fluid d-flex flex-column flex-fill justify-content-center w-100",onKeyup:a[2]||(a[2]=O(()=>q(),["enter"]))},[e("div",Z,[e("div",ee,[e("div",se,[e("div",oe,[e("div",te,[u(e("input",{type:"text",class:w(["form-control",c(i).inputClass("userName")]),placeholder:"","onUpdate:modelValue":a[0]||(a[0]=p=>d.userName=p)},null,2),[[S,d.userName]]),re]),u(e("span",{class:w(c(i).messageClass("userName"))},x(c(i).getMessage("userName")),3),[[f,c(i).hasError("userName")]])]),e("div",ne,[e("div",ae,[u(e("input",{type:"password",class:w(["form-control",c(i).inputClass("password")]),placeholder:"","onUpdate:modelValue":a[1]||(a[1]=p=>d.password=p)},null,2),[[S,d.password]]),ie]),u(e("span",{class:w(c(i).messageClass("password"))},x(c(i).getMessage("password")),3),[[f,c(i).hasError("password")]])]),e("div",ce,[u(e("button",{class:"btn btn-primary w-100",disabled:!E(),onClick:v},[u(e("span",null,"Login",512),[[f,!c(m).isLoading]]),u(e("span",de,null,512),[[f,c(m).isLoading]])],8,le),[[f,!l.loggedIn]]),l.commonError?(y(),b("span",ue,[me,I(" "+x(l.commonError),1)])):T("",!0),l.loggedIn?(y(),b("span",pe,[he,I(" Đăng nhập thành công! ")])):T("",!0)])])])])],32))}}),be=H(fe,[["__scopeId","data-v-0b6ec359"]]);export{be as default};
